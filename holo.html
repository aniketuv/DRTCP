<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRTCP Secure Comm | Zero-Identity</title>
    <style>
        :root {
            --bg-dark: #0f1115;
            --bg-panel: #1a1d24;
            --bg-hover: #2a2d35;
            --primary: #3d7bfa;
            --primary-hover: #2b60d4;
            --danger: #ff4757;
            --danger-hover: #ff6b81;
            --text-main: #ffffff;
            --text-muted: #a0aab5;
            --border-color: #2c313c;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
        }

        /* CSS Grid Layout Strategy */
       .app-container {
            display: grid;
            grid-template-areas:
                "header header"
                "main sidebar"
                "controls controls";
            grid-template-columns: 1fr 320px;
            grid-template-rows: 64px 1fr 80px;
            height: 100vh;
        }

        /* Header */
       .app-header {
            grid-area: header;
            background: var(--bg-panel);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 24px;
            border-bottom: 1px solid var(--border-color);
        }

       .logo { font-size: 1.2rem; font-weight: 700; }
       .logo span { color: var(--primary); }

       .status-badge {
            background: rgba(46, 204, 113, 0.15);
            color: #2ecc71;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        /* Main Video Area */
       .main-content {
            grid-area: main;
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-dark);
        }

       .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            width: 100%;
            max-width: 1400px;
        }

       .video-wrapper {
            position: relative;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            aspect-ratio: 16/9;
            border: 1px solid var(--border-color);
        }

        /* Styling the shadow DOM of the custom elements */
        drtc-local-media, drtc-remote-media {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

       .label {
            position: absolute;
            bottom: 16px;
            left: 16px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Sidebar */
       .sidebar {
            grid-area: sidebar;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-color);
            padding: 24px;
        }

       .control-panel h3 { margin-top: 0; font-size: 1.1rem; color: var(--text-main); }
       .status-text,.small-text { color: var(--text-muted); font-size: 0.9rem; line-height: 1.5; }
       .divider { height: 1px; background: var(--border-color); margin: 24px 0; }

        /* Controls Bar */
       .controls-bar {
            grid-area: controls;
            background: var(--bg-panel);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            border-top: 1px solid var(--border-color);
        }

       .control-button {
            background: var(--bg-hover);
            color: var(--text-main);
            border: 1px solid var(--border-color);
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

       .control-button:hover { background: #383c47; }
       .control-button.danger { background: var(--danger); border-color: var(--danger); }
       .control-button.danger:hover { background: var(--danger-hover); }

       .primary-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            transition: background 0.2s ease;
        }

       .primary-btn:hover { background: var(--primary-hover); }

        /* QR Modal */
       .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

       .modal.hidden { display: none; }

       .modal-content {
            background: var(--bg-panel);
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            position: relative;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }

       .close-btn {
            position: absolute;
            top: 16px; right: 20px;
            font-size: 1.8rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.2s;
        }

       .close-btn:hover { color: var(--text-main); }

       .qr-display {
            display: block;
            margin: 24px auto;
            width: 220px;
            height: 220px;
            background: #fff;
            border-radius: 8px;
            padding: 10px;
        }

        /* Mobile Responsiveness */
        @media (max-width: 900px) {
           .app-container {
                grid-template-areas:
                    "header"
                    "main"
                    "sidebar"
                    "controls";
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr auto 80px;
                overflow-y: auto;
            }
           .main-content { padding: 16px; }
           .sidebar { border-left: none; border-top: 1px solid var(--border-color); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="logo">DRTCP <span>Comm</span></div>
            <div class="status-badge">E2EE Active</div>
        </header>

        <main class="main-content">
            <drtc-session transport="quic">
                
                <drtc-signal type="mdns" namespace="_drtcp._udp.local"></drtc-signal>
                <drtc-signal type="webdht"></drtc-signal>
                <drtc-encryption cipher="AES_128_GCM_SHA256"></drtc-encryption>

                <div class="video-grid">
                    <div class="video-wrapper local">
                        <drtc-local-media audio="true" video="1080p"></drtc-local-media>
                        <span class="label">You (Anonymous DID)</span>
                    </div>
                    <div class="video-wrapper remote">
                        <drtc-remote-media></drtc-remote-media>
                        <span class="label">Remote Peer</span>
                    </div>
                </div>

            </drtc-session>
        </main>

        <aside class="sidebar">
            <div class="control-panel">
                <h3>Connection Status</h3>
                <p class="status-text">Waiting for peer connection via mDNS or WebDHT...</p>
                <div class="divider"></div>
                <h4>Physical Proximity</h4>
                <p class="small-text">In the same room? Scan to establish an air-gapped handshake.</p>
                <button id="showQrBtn" class="primary-btn">Show QR Bootstrap (QWBP)</button>
            </div>
        </aside>

        <footer class="controls-bar">
            <button class="control-button" id="muteBtn">
                <span class="icon">ðŸŽ¤</span> Mute
            </button>
            <button class="control-button" id="videoBtn">
                <span class="icon">ðŸ“·</span> Video Off
            </button>
            <button class="control-button danger" id="leaveBtn">
                End Call
            </button>
        </footer>
    </div>

    <div id="qrModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn" id="closeQrBtn">&times;</span>
            <h2>Scan to Connect</h2>
            <drtc-signal type="qwbp" display="qr-code" class="qr-display"></drtc-signal>
            <p>Scan this with another DRTCP enabled device to connect instantly without the internet.</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // UI Elements
            const muteBtn = document.getElementById('muteBtn');
            const videoBtn = document.getElementById('videoBtn');
            const leaveBtn = document.getElementById('leaveBtn');
            const showQrBtn = document.getElementById('showQrBtn');
            const closeQrBtn = document.getElementById('closeQrBtn');
            const qrModal = document.getElementById('qrModal');

            // UI State
            let isMuted = false;
            let isVideoOff = false;

            // Toggle Microphone UI
            muteBtn.addEventListener('click', () => {
                isMuted =!isMuted;
                muteBtn.innerHTML = isMuted? '<span class="icon">ðŸ”‡</span> Unmute' : '<span class="icon">ðŸŽ¤</span> Mute';
                muteBtn.style.background = isMuted? 'var(--danger)' : 'var(--bg-hover)';
                muteBtn.style.borderColor = isMuted? 'var(--danger)' : 'var(--border-color)';
                
                // Dynamically alters the <drtc-local-media audio="false"> attribute
                const localMedia = document.querySelector('drtc-local-media');
                if (localMedia) localMedia.setAttribute('audio',!isMuted);
            });

            // Toggle Camera UI
            videoBtn.addEventListener('click', () => {
                isVideoOff =!isVideoOff;
                videoBtn.innerHTML = isVideoOff? '<span class="icon">ðŸš«</span> Video On' : '<span class="icon">ðŸ“·</span> Video Off';
                videoBtn.style.background = isVideoOff? 'var(--danger)' : 'var(--bg-hover)';
                videoBtn.style.borderColor = isVideoOff? 'var(--danger)' : 'var(--border-color)';
                
                // Dynamically alters the <drtc-local-media video="false"> attribute
                const localMedia = document.querySelector('drtc-local-media');
                if (localMedia) localMedia.setAttribute('video', isVideoOff? 'false' : '1080p');
            });

            // End Call Execution
            leaveBtn.addEventListener('click', () => {
                // Purging the session tag tells the engine to destroy the ephemeral DID
                const sessionElement = document.querySelector('drtc-session');
                if (sessionElement) {
                    sessionElement.remove();
                    alert('Call terminated securely. Hardware-backed keys have been purged.');
                }
            });

            // QR Code Modal Management
            showQrBtn.addEventListener('click', () => {
                qrModal.classList.remove('hidden');
            });

            closeQrBtn.addEventListener('click', () => {
                qrModal.classList.add('hidden');
            });

            // Close modal if user clicks the dark background overlay
            qrModal.addEventListener('click', (e) => {
                if (e.target === qrModal) {
                    qrModal.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
